<!-- views/providersDashboard -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel='stylesheet', href='/stylesheets/style.css'>
  <title>provider dashboard</title>
  <style>
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }
    .modal-content {
      background-color: #fefefe;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      border-radius: 10px;
    }
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover {
      color: black;
    }
    .profile-link {
      color: blue;
      cursor: pointer;
      text-decoration: underline;
    }
    .profile-link:hover {
      color: darkblue;
    }
    form {
      margin-top: 10px;
    }
    input[type="text"], input[type="email"] {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
      box-sizing: border-box;
    }
    button[type="submit"] {
      background-color: #4CAF50;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button[type="submit"]:hover {
      background-color: #45a049;
    }
    .delete-account {
      color: red;
      cursor: pointer;
      text-decoration: underline;
      margin-top: 10px;
      display: inline-block;
    }
  </style>
</head>
  <body>
    <main>
      <div class="users_wrapper">

        <!--users top section -->
        <div id="users_top">
          <b>WELCOME TO PROVIDER DASHBOARD</b>
          <header><%- include ('partials/header.ejs') %></header>
        </div>

        <!-- users left section -->
        <div id="users_left">
          <a href="/">Home</a><br>
          <span class="profile-link" onclick="openProfileModal()">Profile</span><br>
          <a href="/">Report</a><br>
          <!-- Logout Link -->
          <a href="/providers/logout">Logout</a>

        </div>

        <!-- users container -->
        <div id="users_container">

          <!-- Users details -->
          <div>
            <h1>Welcome, <%= user.firstName %></h1>
            <b>Specialty: <%= user.specialty %></b>
          </div><br>

          <!-- Usera container header -->
          <div class="cHeader">
            <a href="/providers/appointments?status=pending" class="<%= status === 'pending' ? 'active' : '' %>">Pending Appointments</a>
            <a href="/providers/appointments?status=accepted" class="<%= status === 'accepted' ? 'active' : '' %>">Accepted Appointments</a>
            <a href="/providers/appointments?status=cancelled" class="<%= status === 'cancelled' ? 'active' : '' %>">Cancelled Appointments</a>
          </div>

          <!-- Dashboard Views -->
          <div class="dViews" id="dv">
              <a class="dViewsList">
                  <h3>Total Appointments</h3>
                  <p>2222222</p>
              </a>
              <a class="dViewsList">
                  <h3>Total Patients</h3>
                  <p>1111111</p>
              </a>
              <a class="dViewsList">
                  <h3>Total Providers</h3>
                  <p>555555555</p>
              </a>
              <a class="dViewsList">
                  <h3>Emergencies</h3>
                  <p>999999999</p>
              </a>
              <a class="dViewsList">
                  <h3>Reports</h3>
                  <p>55578908</p>
              </a>
              <a class="dViewsList">
                  <h3>Cancelled Appointments</h3>
                  <p>2222222</p>
              </a>
          </div>

          <!-- Profile Modal -->
          <div id="profileModal" class="modal">
            <div class="modal-content">
              <span class="close" onclick="closeProfileModal()">&times;</span>
              <h2>Your Profile</h2>
              <p style="background: rgb(250, 63, 63); font-weight: 800; font-style: oblique; text-align: center; margin: 0 auto; width: 150px;"><strong>Account</strong> <%= user.verify %></p>
              <p><strong>First Name:</strong> <%= user.firstName %></p>
              <p><strong>Last Name:</strong> <%= user.lastName %></p>
              <p><strong>Email:</strong> <%= user.email %></p>
              <p><strong>Specialty:</strong> <span id="specialtyDisplay"><%= user.specialty || 'Not set' %><i id="specialtyEdit" class="edit">Edit</i></span>
                <!-- Edit Specialty Form -->
                <form id="editSpecialtyForm" class="profileEdit" action="/providers/update-specialty" method="POST">
                  <input type="hidden" name="providerId" value="<%= user.id %>">
                  <input type="text" name="specialty" placeholder="Enter new specialty" required>
                  <button id="specialtySubmit" type="submit">Update Specialty</button><span class="editClose" id="specialtyClose">&times;</span>
                </form>
              </p>

              <p><strong>Language:</strong> <span id="languageDisplay"><%= user.language || 'Not set' %><i id="languageEdit" class="edit">Edit</i></span>
                <!-- Edit Language Form -->
                <form id="editLanguageForm" class="profileEdit" action="/providers/update-language" method="POST">
                  <input type="hidden" name="providerId" value="<%= user.id %>">
                  <input type="text" name="language" placeholder="Enter your languages: Native and Foreign!" required>
                  <button id="languageSubmit" type="submit">Update Language</button><span class="editClose" id="languageClose">&times;</span>
                </form>
              </p>

              <p><strong>Location:</strong> <span id="locationDisplay"><%= user.location || 'Not set' %><i id="locationEdit" class="edit">Edit</i></span>
                <!-- Edit Specialty Form -->
                <form id="editLocationForm" class="profileEdit" action="/providers/update-location" method="POST">
                  <input type="hidden" name="providerId" value="<%= user.id %>">
                  <input type="text" name="location" placeholder="Enter your location: eg Region, State, Country" required>
                  <button id="locationSubmit" type="submit">Update Location</button><span class="editClose" id="locationClose">&times;</span>
                </form>
              </p>

              <!-- Delete Account Link -->
              <p>
                <span class="delete-account" onclick="confirmDeleteAccount()">Delete Account</span>
              </p>

              <!-- Delete Account Form (hidden, triggered by JS) -->
              <form id="deleteAccountForm" action="/providers/delete-account" method="POST" style="display: none;">
                <input type="hidden" name="providerId" value="<%= user.id %>">
                <p>Are you sure you want to delete your account? This action cannot be undone.</p>
                <button type="submit" style="background-color: red;">Confirm Delete</button>
                <button type="button" onclick="cancelDeleteAccount()" style="background-color: gray;">Cancel</button>
              </form>
            </div>
          </div>

          <!-- Appointment status filter -->
          <div id="appointmentStatus">
              <h2><%= status.charAt(0).toUpperCase() + status.slice(1) %> Appointments</h2>
              <% if (appointments.length > 0) { %>
                  <table>
                      <thead>
                          <tr>
                              <th>Patient Name</th>
                              <th>Appointment Date</th>
                              <th>Appointment Time</th>
                              <th>Status</th>
                              <th>Actions</th>
                          </tr>
                      </thead>
                      <tbody>
                          <% appointments.forEach(appointment => { %>
                              <tr>
                                  <td><%= appointment.patient_first_name %> <%= appointment.patient_last_name %></td>
                                  <td><%= appointment.appointment_date %></td>
                                  <td><%= appointment.appointment_time %></td>
                                  <td><%= appointment.status %></td>
                                  <td class="action-links">
                                      <% if (appointment.status === 'pending') { %>
                                          <form action="/providers/respond" method="POST">
                                            <input type="hidden" name="appointmentId" value="<%= appointment.appointment_id %>">
                                            <button type="submit" name="action" value="accept">Accept</button>
                                            <button type="submit" name="action" value="cancel">Cancel</button>
                                          </form>
                                      <% } else if (appointment.status === 'accepted') { %>
                                          <form action="/providers/respond" method="POST">
                                            <input type="hidden" name="appointmentId" value="<%= appointment.appointment_id %>">
                                            <button><a href="/chat/<%= appointment.appointment_id %>">Chat</a></button>
                                            <button type="submit" name="action" value="cancel">Cancel</button>
                                          </form>
                                      <% } else if (appointment.status === 'cancelled') { %>
                                          <form action="/providers/respond" method="POST">
                                            <input type="hidden" name="appointmentId" value="<%= appointment.appointment_id %>">
                                            <button type="submit" name="action" value="accept">Re-Accept</button>
                                          </form>
                                      <% } %>
                                  </td>
                              </tr>
                          <% }); %>
                      </tbody>
                  </table>
              <% } else { %>
                  <p>No <%= status %> appointments found.</p>
              <% } %>
          </div>
        </div>

        <!-- users footer -->
        <div id="users_footer"><%- include ('partials/footer.ejs') %></div>
      </div>
    </main>

    
    <script src="/javascripts/main.js"></script>
    <script>
      // Toggle section visibility
        function toggleSection(sectionId) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';
        }

    // Toggle section visibility
        function toggleSection(sectionId) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';
        }

    
    </script>

  </body>
</html>